import pytest

from cogent3 import make_tree
from cogent3.phylo.tree_distance import lin_rajan_moret


def test_different_trees():
    a = make_tree(treestring="(1,(((2,3),4),(5,((6,(7,(8,9))),(10,11)))),12);")
    b = make_tree(treestring="(1,((((2,3),4),5),((6,7),((8,9),(10,11)))),12);")

    distance = lin_rajan_moret(a, b)

    assert distance == 8

    a = make_tree(treestring="((3:0.00,75:0.00):0.00,(((((((((((((((((((((((1:0.00,57:0.00):0.00,29:0.00):0.00,62:0.00):0.00,43:0.00):0.00,31:0.00):0.00,(59:0.00,89:0.00):0.00):0.00,(67:0.00,100:0.00):0.00):0.00,(((((17:0.00,61:0.00):0.00,44:0.00):0.00,46:0.00):0.00,72:0.00):0.00,82:0.00):0.00):0.00,(((((((((((((4:0.00,15:0.00):0.00,95:0.00):0.00,77:0.00):0.00,54:0.00):0.00,53:0.00):0.00,((12:0.00,64:0.00):0.00,((35:0.00,41:0.00):0.00,(86:0.00,92:0.00):0.00):0.00):0.00):0.00,((((((6:0.00,56:0.00):0.00,32:0.00):0.00,((23:0.00,52:0.00):0.00,81:0.00):0.00):0.00,42:0.00):0.00,10:0.00):0.00,(((((((19:0.00,25:0.00):0.00,39:0.00):0.00,71:0.00):0.00,83:0.00):0.00,(36:0.00,66:0.00):0.00):0.00,94:0.00):0.00,(20:0.00,(68:0.00,79:0.00):0.00):0.00):0.00):0.00):0.00,(7:0.00,38:0.00):0.00):0.00,(13:0.00,(63:0.00,99:0.00):0.00):0.00):0.00,(85:0.00,87:0.00):0.00):0.00,58:0.00):0.00,28:0.00):0.00,8:0.00):0.00):0.00,98:0.00):0.00,47:0.00):0.00,((((30:0.00,34:0.00):0.00,55:0.00):0.00,37:0.00):0.00,(70:0.00,76:0.00):0.00):0.00):0.00,(33:0.00,96:0.00):0.00):0.00,80:0.00):0.00,((((9:0.00,16:0.00):0.00,91:0.00):0.00,(74:0.00,84:0.00):0.00):0.00,27:0.00):0.00):0.00,78:0.00):0.00,(11:0.00,(49:0.00,51:0.00):0.00):0.00):0.00,40:0.00):0.00,(((45:0.00,90:0.00):0.00,97:0.00):0.00,93:0.00):0.00):0.00,48:0.00):0.00,((((5:0.00,21:0.00):0.00,(18:0.00,(26:0.00,(50:0.00,69:0.00):0.00):0.00):0.00):0.00,(14:0.00,22:0.00):0.00):0.00,88:0.00):0.00):0.00,73:0.00):0.00,(24:0.00,65:0.00):0.00):0.00,(2:0.00,60:0.00):0.00);")
    b = make_tree(treestring="((((((3:0.00,65:0.00):0.00,(28:0.00,57:0.00):0.00):0.00,9:0.00):0.00,38:0.00):0.00,(61:0.00,98:0.00):0.00):0.00,(((((((((((((1:0.00,(((((5:0.00,11:0.00):0.00,84:0.00):0.00,88:0.00):0.00,95:0.00):0.00,56:0.00):0.00):0.00,7:0.00):0.00,68:0.00):0.00,(((20:0.00,55:0.00):0.00,47:0.00):0.00,58:0.00):0.00):0.00,62:0.00):0.00,(78:0.00,93:0.00):0.00):0.00,((4:0.00,64:0.00):0.00,10:0.00):0.00):0.00,(37:0.00,86:0.00):0.00):0.00,97:0.00):0.00,(32:0.00,60:0.00):0.00):0.00,(8:0.00,19:0.00):0.00):0.00,(44:0.00,52:0.00):0.00):0.00,49:0.00):0.00,((((((((((((((((((((((((((((2:0.00,39:0.00):0.00,(31:0.00,69:0.00):0.00):0.00,41:0.00):0.00,29:0.00):0.00,(6:0.00,((83:0.00,96:0.00):0.00,99:0.00):0.00):0.00):0.00,16:0.00):0.00,13:0.00):0.00,27:0.00):0.00,75:0.00):0.00,74:0.00):0.00,(((22:0.00,89:0.00):0.00,36:0.00):0.00,26:0.00):0.00):0.00,((35:0.00,43:0.00):0.00,(46:0.00,67:0.00):0.00):0.00):0.00,((23:0.00,(53:0.00,81:0.00):0.00):0.00,(((34:0.00,71:0.00):0.00,82:0.00):0.00,100:0.00):0.00):0.00):0.00,77:0.00):0.00,(((((14:0.00,72:0.00):0.00,33:0.00):0.00,54:0.00):0.00,51:0.00):0.00,15:0.00):0.00):0.00,(((17:0.00,48:0.00):0.00,25:0.00):0.00,73:0.00):0.00):0.00,80:0.00):0.00,92:0.00):0.00,59:0.00):0.00,40:0.00):0.00,85:0.00):0.00,63:0.00):0.00,((18:0.00,79:0.00):0.00,21:0.00):0.00):0.00,66:0.00):0.00,76:0.00):0.00,(12:0.00,94:0.00):0.00):0.00,(((24:0.00,87:0.00):0.00,(45:0.00,91:0.00):0.00):0.00,((42:0.00,(50:0.00,70:0.00):0.00):0.00,90:0.00):0.00):0.00):0.00,30:0.00):0.00);")

    distance = lin_rajan_moret(a, b)

    assert distance == 1402

    

def test_same_tree():
    a = make_tree(treestring="(a, b, (c, d));")
    b = make_tree(treestring="(c, d, (a, b));")

    distance = lin_rajan_moret(a, b)

    assert distance == 0

def test_fails_different_tips():
    a = make_tree(treestring="(a, b, (c, d));")
    b = make_tree(treestring="(e, d, (a, b));")

    with pytest.raises(ValueError):
        lin_rajan_moret(a,b)
    
    a = make_tree(treestring="(a, b, (c, d));")
    b = make_tree(treestring="(a, d, (a, b));")

    with pytest.raises(ValueError):
        lin_rajan_moret(a,b)

def test_fails_unrooted():
    a = make_tree(treestring="((a, b), (c, d));")
    b = make_tree(treestring="(e, d, (a, b));")

    with pytest.raises(ValueError):
        lin_rajan_moret(a,b)
    
    a = make_tree(treestring="(a, b, (c, d));")
    b = make_tree(treestring="((e, d), (a, b));")

    with pytest.raises(ValueError):
        lin_rajan_moret(a,b)

    a = make_tree(treestring="((a, b), (c, d));")
    b = make_tree(treestring="((e, d), (a, b));")

    with pytest.raises(ValueError):
        lin_rajan_moret(a,b)